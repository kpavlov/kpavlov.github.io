<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    
    <title>Establishing Customizable Tomcat Configuration - The Culture of Code</title>
    

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="generator" content="Hugo 0.25" />

    
    
    <meta name="description" content="">

	<meta property="og:title" content="Establishing Customizable Tomcat Configuration" />
<meta property="og:description" content="Deploying to Apache Tomcat often requires making changes to default configuration.
These changes are often environment specific.
Also, when upgrading a Tomcat to new version you need to be sure that all your custom changes have not been lost and were applied to new configuration.
To deal with all that stuff Tomcat via separation of the configuration.
This post contains step-by-step instruction will help you to establish custom tomcat configuration.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://konstantinpavlov.net/blog/2014/03/22/establishing-customizable-tomcat-configuration/" />



<meta property="article:published_time" content="2014-03-22T12:40:16&#43;03:00"/>
<meta property="article:modified_time" content="2014-03-22T12:40:16&#43;03:00"/>











    
    
<meta itemprop="name" content="Establishing Customizable Tomcat Configuration">
<meta itemprop="description" content="Deploying to Apache Tomcat often requires making changes to default configuration.
These changes are often environment specific.
Also, when upgrading a Tomcat to new version you need to be sure that all your custom changes have not been lost and were applied to new configuration.
To deal with all that stuff Tomcat via separation of the configuration.
This post contains step-by-step instruction will help you to establish custom tomcat configuration.
">


<meta itemprop="dateModified" content="2014-03-22T12:40:16&#43;03:00" />
<meta itemprop="wordCount" content="610">



<meta itemprop="keywords" content="tomcat,spring," />

    

  <meta name="twitter:card" content="summary"/>



<meta name="twitter:text:title" content="Establishing Customizable Tomcat Configuration"/>
<meta name="twitter:title" content="Establishing Customizable Tomcat Configuration"/>
<meta name="twitter:description" content="Deploying to Apache Tomcat often requires making changes to default configuration.
These changes are often environment specific.
Also, when upgrading a Tomcat to new version you need to be sure that all your custom changes have not been lost and were applied to new configuration.
To deal with all that stuff Tomcat via separation of the configuration.
This post contains step-by-step instruction will help you to establish custom tomcat configuration.
"/>



    

<meta name="twitter:site" content="@k_pavlov">

<meta name="twitter:creator" content="k_pavlov">





<meta property="fb:admins" content="">

    <link href='../../../../../index.xml' rel="alternate" title="The Culture of Code" type="application/atom+xml">
    <link href="../../../../../favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="../../../../../apple-touch-icon-precomposed.png" rel="apple-touch-icon">

    <link href="//fonts.googleapis.com/" rel="dns-prefetch">
    <link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Open+Sans:700,400&subset=latin,latin-ext" rel="stylesheet">

    <link rel="stylesheet" href="../../../../../assets/css/style.css?v=1505064001">
    <link rel="stylesheet" href="../../../../../assets/css/prism.min.css?v=1505064001"/>

    <script type="text/javascript">
        
        
        window.paceOptions = {
            catchupTime: 100,
            minTime: 100,
            elements: false,
            restartOnRequestAfter: 500,
            startOnPageLoad: true
        };

        
        
        window.GHOSTIUM = {
          haveGA: true,
          haveDisqus: true,
          enablePjax: true
        }
    </script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"
            integrity="sha256-ffw+9zwShMev88XNrDgS0hLIuJkDfXhgyLogod77mn8="
            crossorigin="anonymous" defer></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"
            integrity="sha256-EPrkNjGEmCWyazb3A/Epj+W7Qm2pB9vnfXw+X6LImPM=" crossorigin="anonymous" defer></script>
    <script type='text/javascript'>
        window.Modernizr || document.write('<script src="../../../../../assets/js/modernizr-2.8.3.min.js" defer>\x3C/script>');
        window.Pace || document.write('<script src="../../../../../assets/js/pace-1.0.2.min.js" defer>\x3C/script>');
    </script>
</head>

<body class="">



<main id="container" role="main" class="container">
    <div class="surface">
        <div class="surface-container">
            <div data-pjax-container class="content">

                <section class="wrapper wrapper-post">
                    <div class="wrapper-container">
                        <article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
                            <section class="post-container">
                                <header class="post-header">
                                    <ul class="post-meta-list">
                                        <li class="post-item-meta-item">
                                            <time datetime='2014-03-22'
                                                  itemprop="datePublished">
                                                2014-03-22
                                            </time>
                                        </li>
                                        
<li class="post-item-meta-item">


    
    <a itemprop="articleSection" href="../../../../../categories/devops/" data-pjax rel="category" >devops</a>
    

</li>


                                        
<li class="post-item-meta-item">


    
    <a itemprop="articleSection" href="../../../../../tags/tomcat/" data-pjax rel="tag">#tomcat</a>
    ,

    
    <a itemprop="keywords" href="../../../../../tags/spring/" data-pjax rel="tag">#spring</a>
    

</li>



                                        
                                        <li class="post-item-meta-item">
                                            <a href="https://konstantinpavlov.net/blog/2014/03/22/establishing-customizable-tomcat-configuration/#disqus_thread"
                                               data-disqus-identifier='20140322124016'>Comments</a>
                                        </li>
                                        
                                        <li class="post-item-meta-item" title="Estimated reading time"
                                            itemprop="timeRequired">
                                            <meta itemprop="duration" content="T3M"/>
                                            ~3 min
                                        </li>
                                    </ul>
                                    <h1 itemprop="name headline" class="post-title">
                                        <a href="https://konstantinpavlov.net/blog/2014/03/22/establishing-customizable-tomcat-configuration/" itemprop="url" data-pjax
                                           title="Establishing Customizable Tomcat Configuration">Establishing Customizable Tomcat Configuration</a></h1>
                                    
                                    
                                </header>
                                <aside class="post-side">
                                    <div class="post-author">
                                        <a href="https://konstantinpavlov.net/"
                                           class="post-author-avatar">
                                            <img src="../../../../../img/avatar-128.png"
                                                 alt="Konstantin Pavlov">
                                        </a>
                                        <div class="post-author-info">
                                            <a href="https://konstantinpavlov.net/"
                                               class="post-author-name">
                                                Konstantin Pavlov
                                            </a>
                                            <p class="post-author-bio"></p>
                                        </div>
                                    </div>
                                </aside>
                                <div itemprop="articleBody" class="post-body">
                                    <p>Deploying to <a href="http://tomcat.apache.org" target="_blank">Apache Tomcat</a> often requires making changes to default configuration.
These changes are often environment specific.
Also, when upgrading a Tomcat to new version you need to be sure that all your custom changes have not been lost and were applied to new configuration.
To deal with all that stuff Tomcat via separation of the configuration.
This post contains step-by-step instruction will help you to establish custom tomcat configuration.
</p>

<h2 id="1-installing-tomcat">1. Installing tomcat</h2>

<p>You download Tomcat distribution binary and extract it to some folder.
I put it to <code>~/java/apache-tomcat-7.0.52</code>.
It is desirable to create a symlink to it. It would allow to switch to another version of tomcat without changing your scripts</p>

<pre><code class="language-bash">ln -s ~/java/apache-tomcat-7.0.52 ~/java/tomcat
</code></pre>

<p>As alternative, you may install a tomcat from packages.</p>

<h2 id="2-create-a-folder-to-keep-your-custom-configuration">2. Create a folder to keep your custom configuration</h2>

<ol>
<li><p>Create a folder where you custom configuration will be located.</p>

<pre><code class="language-bash">mkdir -p ~/java/custom-tomcat/{bin,conf,logs,work,webapps,temp}
</code></pre></li>

<li><p>Copy default <code>server.xml</code>, <code>tomcat-users.xml</code> configuration file to custom location. If you already have a customized <code>server.xml</code> then put it there</p>

<pre><code class="language-bash">cp -v ~/java/tomcat/conf/server.xml ~/java/tomcat/conf/tomcat-users.xml ~/java/custom-tomcat/conf/[](null)
</code></pre></li>

<li><p>Set system property <code>$CATALINA_BASE</code> referring to base directory for resolving dynamic portions of a Catalina installation.</p>

<pre><code class="language-bash">export CATALINA_BASE=~/java/custom-tomcat
</code></pre>

<p>Now you can start the Tomcat and see that it uses your custom configuration folder:</p>

<pre><code>$ ./catalina.sh run
Using CATALINA_BASE:   /Users/maestro/java/custom-tomcat
Using CATALINA_HOME:   /Users/maestro/java/tomcat
Using CATALINA_TMPDIR: /Users/maestro/java/custom-tomcat/temp
...
</code></pre></li>
</ol>

<h2 id="3-tomcat-runtime-parameters-customization">3. Tomcat runtime parameters customization</h2>

<p>To specify JVM options to be used when tomcat server is run, create a bash script <code>$CATALINA_BASE/bin/setenv.sh</code>. It will keep environment variables referred in <code>catalina.sh</code> script to keep your customizations separate.</p>

<p>Define <code>$CATALINA_OPTS</code> inside <code>setenv.sh</code>.  Include here and not in JAVA_OPTS all options, that should only be used by Tomcat itself, not by the stop process, the version command etc. Examples are heap size, GC logging, JMX ports etc.</p>

<p>Example <code>setenv.sh</code>:</p>

<pre><code class="language-bash">echo &quot;Setting parameters from $CATALINA_BASE/bin/setenv.sh&quot;
echo &quot;_______________________________________________&quot;

# discourage address map swapping by setting Xms and Xmx to the same value
# http://confluence.atlassian.com/display/DOC/Garbage+Collector+Performance+Issues
export CATALINA_OPTS=&quot;$CATALINA_OPTS -Xms1024m&quot;
export CATALINA_OPTS=&quot;$CATALINA_OPTS -Xmx1025m&quot;

# Increase maximum perm size for web base applications to 4x the default amount
# http://wiki.apache.org/tomcat/FAQ/Memoryhttp://wiki.apache.org/tomcat/FAQ/Memory
export CATALINA_OPTS=&quot;$CATALINA_OPTS -XX:MaxPermSize=256m&quot;

# Oracle Java as default, uses the serial garbage collector on the
# Full Tenured heap. The Young space is collected in parallel, but the
# Tenured is not. This means that at a time of load if a full collection
# event occurs, since the event is a 'stop-the-world' serial event then
# all application threads other than the garbage collector thread are
# taken off the CPU. This can have severe consequences if requests continue
# to accrue during these 'outage' periods. (specifically webservices, webapps)
# [Also enables adaptive sizing automatically]
export CATALINA_OPTS=&quot;$CATALINA_OPTS -XX:+UseParallelGC&quot;

# The hotspot server JVM has specific code-path optimizations
# which yield an approximate 10% gain over the client version.
export CATALINA_OPTS=&quot;$CATALINA_OPTS -server&quot;

# Disable remote (distributed) garbage collection by Java clients
# and remove ability for applications to call explicit GC collection
export CATALINA_OPTS=&quot;$CATALINA_OPTS -XX:+DisableExplicitGC&quot;

# Check for application specific parameters at startup
if [ -r &quot;$CATALINA_BASE/bin/appenv.sh&quot; ]; then
  . &quot;$CATALINA_BASE/bin/appenv.sh&quot;
fi

echo &quot;Using CATALINA_OPTS:&quot;
for arg in $CATALINA_OPTS
do
    echo &quot;&gt;&gt; &quot; $arg
done
echo &quot;&quot;

echo &quot;Using JAVA_OPTS:&quot;
for arg in $JAVA_OPTS
do
    echo &quot;&gt;&gt; &quot; $arg
done

echo &quot;_______________________________________________&quot;
echo &quot;&quot;
</code></pre>

<h2 id="4-migrate-logging-to-logback">4. Migrate logging to Logback</h2>

<p>Tomcat is configured to use Apache Commons Logging API by default.
If you are using <a href="http://slf4j.org" target="_blank">slf4j</a> in your application and familiar with <a href="http://logback.qos.ch" target="_blank">Logback</a>, then it is reasonable to migrate your tomcat configuration to logback too. You may find details <a href="http://hwellmann.blogspot.com/2012/11/logging-with-slf4j-and-logback-in.html" target="_blank">here</a></p>

<h2 id="links">Links</h2>

<ul>
<li><a href="https://github.com/kpavlov/tomcat-custom-env" target="_blank">https://github.com/kpavlov/tomcat-custom-env</a> - Custom tomcat installation example on GitHub</li>
<li><a href="https://github.com/terrancesnyder/tomcat" target="_blank">https://github.com/terrancesnyder/tomcat</a> - Tomcat Best Practices Shell</li>
<li><a href="http://hwellmann.blogspot.com/2012/11/logging-with-slf4j-and-logback-in.html" target="_blank">http://hwellmann.blogspot.com/2012/11/logging-with-slf4j-and-logback-in.html</a></li>
<li><a href="https://gist.github.com/terrancesnyder/986029" target="_blank">https://gist.github.com/terrancesnyder/986029</a> - example setenv.sh with defaults set for minimal time spent in garbage collection</li>
<li><a href="http://wiki.apache.org/tomcat/FAQ/Memoryhttp://wiki.apache.org/tomcat/FAQ/Memory" target="_blank">http://wiki.apache.org/tomcat/FAQ/Memoryhttp://wiki.apache.org/tomcat/FAQ/Memory</a></li>
<li><a href="http://confluence.atlassian.com/display/DOC/Garbage+Collector+Performance+Issues" target="_blank">http://confluence.atlassian.com/display/DOC/Garbage+Collector+Performance+Issues</a></li>
</ul>
                                </div>
                                <footer class="post-footer">
                                    
                                    <div itemprop="author" itemscope itemtype="http://schema.org/Person"
                                         class="post-author">
                                        <a href="https://konstantinpavlov.net/" class="post-author-avatar">
                                            <img itemprop="image"
                                                 src="../../../../../img/avatar-128.png"
                                                 alt="Konstantin Pavlov">
                                        </a>
                                        <div class="post-author-info">
                                            <h4 class="post-footer-heading">Written By</h4>
                                            <a href="https://konstantinpavlov.net/" itemprop="url"
                                               class="post-author-name">
                                                <span itemprop="name">Konstantin Pavlov</span>
                                            </a>
                                            <p itemprop="description" class="post-author-bio"></p>
                                            
                                            <p class="post-author-location" itemprop="homeLocation">Limassol, Cyprus</p>
                                            
                                            
                                            <p class="post-info">
                                                <b class="post-info-title">Published on</b>
                                                <time class="post-date">Mar 22, 2014</time>
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="post-social">
                                        <h4 class="post-footer-heading">Spread the word</h4>
                                        <a href="#" data-action="share-twitter"><i
                                                class="fa fa-fw fa-lg fa-twitter"></i></a>
                                        <a href="#" data-action="share-facebook"><i
                                                class="fa fa-fw fa-lg fa-facebook"></i></a>
                                        <a href="#" data-action="share-gplus"><i
                                                class="fa fa-fw fa-lg fa-google-plus"></i></a>
                                    </div>
                                </footer>

                                <nav role="pagination" class="post-list-pagination">
                                    
                                    <a href="https://konstantinpavlov.net/blog/2014/03/24/continuous-deployment-versioning-and-git/"
                                       class="post-list-pagination-item post-list-pagination-item-prev"
                                       title="Continuous Deployment, Versioning and Git" data-pjax rel="prev">
                                        <i class="fa fa-angle-double-left"></i>&nbsp;Continuous Deployment, Versioning and Git
                                    </a>
                                    
                                    
                                    <a href="https://konstantinpavlov.net/blog/2014/03/21/getting-more-entropy-in-java-on-linux/"
                                       class="post-list-pagination-item post-list-pagination-item-next"
                                       title="Getting More Entropy in Java on Linux" data-pjax rel="next">
                                        Getting More Entropy in Java on Linux&nbsp;<i class="fa fa-angle-double-right"></i>
                                    </a>
                                    
                                </nav>

                            </section>
                            
                            <section itemprop="comment" class="post-comments">
                                <div id="disqus_thread"></div>
                            </section>
                            
                        </article>

                        <footer role="contentinfo" class="footer">
  <p><small>© 2017. All Rights Reserved.</small></p>
  <p><small>Hugo <a href="https://github.com/kpavlov/hugo-theme-ghostiumx" target="_blank">GhostiumX Theme</a> by <a href="https://twitter.com/k_pavlov" target="_blank">@k_pavlov</a> based on original <a href="http://ghostium.oswaldoacauan.com/" target="_blank">Ghostium Theme</a> by <a href="https://twitter.com/oswaldoacauan" target="_blank">@oswaldoacauan</a></small></p>
  <p><small>Proudly published with <a href="http://gohugo.io/" target="_blank">Hugo</a></small></p>
</footer>

                    </div>
                </section>
            </div>
        </div>
    </div>
</main>

<button data-action="open-drawer" id="drawer-button" class="drawer-button"><i class="fa fa-bars"></i></button>
<nav tabindex="-1" class="drawer">
  <div class="drawer-container">
    
    <ul role="navigation" class="drawer-list">
      <li class="drawer-list-item">
  <a href="https://konstantinpavlov.net//" rel="start" data-pjax>
    <i class="fa fa-home"></i>Home
  </a>
</li>
<li class="drawer-list-item">
  <a href="https://konstantinpavlov.net//categories/" data-pjax>
    <i class="fa fa-tags"></i>Categories
  </a>
</li>
<li class="drawer-list-item">
  <a href="https://konstantinpavlov.net//tags/" data-pjax>
    <i class="fa fa-hashtag"></i>Tags
  </a>
</li>
<li class="drawer-list-item">
  <a href="../../../../../index.xml" target="_blank">
    <i class="fa fa-rss"></i>Subscribe to Feed
  </a>
</li>


<li class="drawer-list-item">
  <a href="../../../../../about/" data-pjax><i class="fa fa-user-circle-o" aria-hidden="true"></i>About</a>
</li>


<li class="drawer-list-divider"></li>
<li class="drawer-list-item drawer-list-title">
  Follow me
</li>



<li class="drawer-list-item">
  <a href="http://twitter.com/k_pavlov" target="_blank">
    <i class="fa fa-twitter"></i>Twitter
  </a>
</li>


<li class="drawer-list-item">
  <a href="https://github.com/kpavlov" target="_blank">
    <i class="fa fa-github"></i>Github
  </a>
</li>



<li class="drawer-list-item">
  <a href="http://www.linkedin.com/in/kpavlov" target="_blank">
    <i class="fa fa-linkedin"></i>LinkedIn
  </a>
</li>



    </ul>
  </div>
</nav>

<div class="drawer-overlay"></div>


    <script src="https://code.jquery.com/jquery-3.2.1.min.js" defer></script>
    <script>
        window.jQuery || document.write('<script src="assets/js/jquery-3.2.1.min.js" defer>\x3C/script>');
    </script>

    

   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.pjax/1.9.6/jquery.pjax.min.js"
           integrity="sha256-Xuf/Wtp4J0pHH1OolTHfRbWP2FkR6WaB69ut7w4FxpY=" crossorigin="anonymous" defer></script>

    <dialog id="cookiePolicyPopup" open="false" style="display: none">

  This site uses cookies to ensure you get the best experience on the site. By continuing to use the site, you agree to accept these cookies.
     <div role="toolbar">
         <button id="cookiePolicyAccept">OK</button>
         <a href="../../../../../legal/cookie-policy">Read More</a>
     </div>
</dialog>
    <script src="../../../../../assets/js/prism.min.js?v=1505064001" defer></script>
    <script src="../../../../../assets/js/foot-scripts.min.js?v=1505064001" defer></script>

    <script type="text/javascript">

      
        
          if(GHOSTIUM.haveDisqus) {
            var disqus_developer = 1;
            var disqus_shortname = 'konstantinpavlov';


            if(typeof DISQUS !== 'object') {
              (function () {
              var s = document.createElement('script'); s.async = true;
              s.type = 'text/javascript';
              s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
              }());
            }
          } else {
            document.querySelector('.post-comments').remove();
          }
        
      


      (function(g,h,o,s,t,z){g.GoogleAnalyticsObject=s;g[s]||(g[s]=
              function(){(g[s].q=g[s].q||[]).push(arguments)});g[s].s=+new Date;
          t=h.createElement(o);z=h.getElementsByTagName(o)[0];
          t.src='https://www.google-analytics.com/analytics.js';
          z.parentNode.insertBefore(t,z)}(window,document,'script','ga'));
      ga('create','UA-2530248-1');ga('send','pageview');


      if(GHOSTIUM.haveDisqus) {
        var disqus_developer = 1;
        var disqus_shortname = 'konstantinpavlov';

        (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
      }
    </script>

</body>
</html>
