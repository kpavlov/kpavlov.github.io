<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    
      
    <title>The Culture of Code</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="generator" content="Hugo 0.17" />

    
    
    <meta name="description" content="">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="The Culture of Code">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="The Culture of Code">
    <meta property="og:description" content="">

    
<meta name="twitter:site" content="@yourblogtwitter">



<meta name="twitter:creator" content="k_pavlov">



<meta name="google-site-verification" content="">


<meta property="fb:admins" content="">


    <link href='http://blog.konstantinpavlov.net/index.xml' rel="alternate" title="The Culture of Code" type="application/atom+xml">
    <link href="http://blog.konstantinpavlov.net/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="http://blog.konstantinpavlov.net/apple-touch-icon-precomposed.png" rel="apple-touch-icon">

    <link href="//fonts.googleapis.com/" rel="dns-prefetch">
    <link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Open+Sans:700,400&subset=latin,latin-ext" rel="stylesheet">

    <link rel="stylesheet" href="http://blog.konstantinpavlov.net/assets/css/style.css?v=1477977074">
    <link rel="stylesheet" href="http://blog.konstantinpavlov.net/assets/css/prism.min.css?v=1477977074"/>

    <script type="text/javascript">
        
        
        window.paceOptions = {
            catchupTime: 100,
            minTime: 100,
            elements: false,
            restartOnRequestAfter: 500,
            startOnPageLoad: true
        };

        
        
        window.GHOSTIUM = {
          haveGA: true,
          haveDisqus: true,
          enablePjax: true
        }
    </script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js" integrity="sha256-ffw+9zwShMev88XNrDgS0hLIuJkDfXhgyLogod77mn8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js" integrity="sha256-EPrkNjGEmCWyazb3A/Epj+W7Qm2pB9vnfXw+X6LImPM=" crossorigin="anonymous"></script>
    <script type='text/javascript'>
        window.Modernizr || document.write('<script src="http://blog.konstantinpavlov.net/assets/js/modernizr-2.8.3.min.js">\x3C/script>');
        window.Pace || document.write('<script src="http://blog.konstantinpavlov.net/assets/js/pace-1.0.2.min.js">\x3C/script>');
    </script>
</head>

  <body class="">
    <button data-action="open-drawer" id="drawer-button" class="drawer-button"><i class="fa fa-bars"></i></button>
<nav tabindex="-1" class="drawer">
  <div class="drawer-container">
    
    <ul role="navigation" class="drawer-list">
      <li class="drawer-list-item">
  <a href="http://blog.konstantinpavlov.net//" rel="start" data-pjax>
    <i class="fa fa-home"></i>Home
  </a>
</li>
<li class="drawer-list-item">
  <a href="http://blog.konstantinpavlov.net//categories/" data-pjax>
    <i class="fa fa-tags"></i>Categories
  </a>
</li>
<li class="drawer-list-item">
  <a href="http://blog.konstantinpavlov.net//tags/" data-pjax>
    <i class="fa fa-hashtag"></i>Tags
  </a>
</li>
<li class="drawer-list-item">
  <a href="http://blog.konstantinpavlov.net/index.xml" target="_blank">
    <i class="fa fa-rss"></i>Subscribe to Feed
  </a>
</li>


<li class="drawer-list-item">
  <a href="http://blog.konstantinpavlov.net/about/" data-pjax><i class="fa fa-user-circle-o" aria-hidden="true"></i>About</a>
</li>


<li class="drawer-list-divider"></li>
<li class="drawer-list-item drawer-list-title">
  Follow me
</li>



<li class="drawer-list-item">
  <a href="http://twitter.com/k_pavlov" target="_blank">
    <i class="fa fa-twitter"></i>Twitter
  </a>
</li>


<li class="drawer-list-item">
  <a href="https://github.com/kpavlov" target="_blank">
    <i class="fa fa-github"></i>Github
  </a>
</li>



<li class="drawer-list-item">
  <a href="http://www.linkedin.com/in/kpavlov" target="_blank">
    <i class="fa fa-linkedin"></i>LinkedIn
  </a>
</li>



    </ul>
  </div>
</nav>


    
    
    

    <div class="drawer-overlay"></div>
    <main id="container" role="main" class="container">
      <div class="surface">
        <div class="surface-container">
          <div data-pjax-container class="content">

<section class="wrapper wrapper-post">
  <div class="wrapper-container">
    <article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
        <section class="post-container">
          <header class="post-header">
            <ul class="post-meta-list">
              <li class="post-item-meta-item">
                <time datetime='2014-05-09' itemprop="datePublished">
                  2014-05-09
                </time>
              </li>
              
<li class="post-item-meta-item">


    
    <a itemprop="articleSection" href="http://blog.konstantinpavlov.net/categories/programming/" data-pjax rel="category" >programming</a>
    

</li>


              
<li class="post-item-meta-item">


    
    <a itemprop="articleSection" href="http://blog.konstantinpavlov.net/tags/java/" data-pjax rel="tag">#java</a>
    ,

    
    <a itemprop="keywords" href="http://blog.konstantinpavlov.net/tags/tomcat/" data-pjax rel="tag">#tomcat</a>
    ,

    
    <a itemprop="keywords" href="http://blog.konstantinpavlov.net/tags/spring/" data-pjax rel="tag">#spring</a>
    ,

    
    <a itemprop="keywords" href="http://blog.konstantinpavlov.net/tags/jmx/" data-pjax rel="tag">#jmx</a>
    

</li>



              
              <li class="post-item-meta-item">
                <a href="http://blog.konstantinpavlov.net/blog/2014/05/09/webapp-inter-communication-in-tomcat/#disqus_thread" data-disqus-identifier='20140509224012'>Comments</a>
              </li>
              
              <li class="post-item-meta-item" title="Estimated reading time" itemprop="timeRequired">
                  <meta itemprop="duration" content="T4M" />
                  ~4 min
              </li>
            </ul>
            <h1 itemprop="name headline" class="post-title"><a href="http://blog.konstantinpavlov.net/blog/2014/05/09/webapp-inter-communication-in-tomcat/" itemprop="url" data-pjax title="Webapp Inter-Communication in Tomcat">Webapp Inter-Communication in Tomcat</a></h1>
            
            
          </header>
          <aside class="post-side">
            <div class="post-author">
                <a href="http://blog.konstantinpavlov.net/" class="post-author-avatar">
                  <img src="http://blog.konstantinpavlov.net/img/avatar-128.png" alt="Konstantin Pavlov">
                </a>
              <div class="post-author-info">
                <a href="http://blog.konstantinpavlov.net/" class="post-author-name">
                  Konstantin Pavlov
                </a>
                <p class="post-author-bio"></p>
              </div>
            </div>
          </aside>
          <div itemprop="articleBody" class="post-body">
            <p><em>Sometimes you need to access services deployed in one web application from another web application within same application server. For Tomcat there is not so many options to do it. In this article we&rsquo;ll discuss you how to use JMX for communication between web applications.</em>
</p>

<p>When both web applications are deployed on the same <a href="http://tomcat.apache.org" title="Apache Tomcat" target="_blank">Tomcat server</a> instance there are, at least, two options to communicate between them:</p>

<ol>
<li>Create a JAX-WS or RESTful webservice in A.war and invoke it via http client from B.war</li>
<li>Expose a service as managed bean in A.war and invoke it via JMX from B.war</li>
</ol>

<p>There are at least two disadvantage of the first approach:</p>

<ol>
<li>Your webservice becomes available to the public and there is a security risk unless you protect access to that service, if you care about this.</li>
<li>Web service invocation is not free. Marshalling/unmarshalling is required.</li>
<li>You&rsquo;ll have to write a service endpoint class.</li>
</ol>

<p>But there is an advantage:</p>

<ol>
<li>You may choose deploy your service to different Tomcat. It will not require much work to reconfigure your services.</li>
<li>You should not care about classloader issues.</li>
</ol>

<p>Second solution uses existing server infrastructure. It also may cause a security risk if your JMX services are accessible by remote clients. But it is not often a case, or JMX is usually not as vulnerable as HTTP port.
Also, you may not warry about marshalling/unmarshalling or serialisation/deserializartion.</p>

<p>Let&rsquo;s discuss a third solution (JMX) in details.</p>

<h2 id="exposing-and-accessing-managed-beans-with-springframework">Exposing and Accessing Managed Beans with SpringFramework</h2>

<p>Tomcat has it&rsquo;s own JMX Server and <a href="http://springframework.org" target="_blank">SpringFramework</a> has JMX exporter feature out of the box.</p>

<p>Let&rsquo;s start with simple example.
We&rsquo;ll create first web application <code>service.war</code> exposing <a href="https://gist.github.com/kpavlov/3e19dcec52b56d550e21#file-api-jar-echoservice" target="_blank"><code>EchoService</code></a> via JMX.
Then we&rsquo;ll access that service in a second web application <code>ui.war</code> from within a servlet.</p>

<p>Let&rsquo;s create a maven project with 3 modules:</p>

<pre><code class="language-xml">&lt;modules&gt;
    &lt;module&gt;api.jar&lt;/module&gt;
    &lt;module&gt;service.war&lt;/module&gt;
    &lt;module&gt;ui.war&lt;/module&gt;
&lt;/modules&gt;
</code></pre>

<p>First module, <em>api.jar</em>, will contain a service interface, <code>EchoService</code> which is pretty simple
(here and later imports are omitted):</p>

<pre><code class="language-xml">public interface EchoService {

    public static final String MBEAN_NAME = &quot;com.example:type=service,name=EchoService&quot;;

    String echo(String input);
}
</code></pre>

<p>Second module, <em>service.war</em>, will contain a <a href="https://gist.github.com/kpavlov/3e19dcec52b56d550e21#file-service-war-echoserviceimpl" target="_blank">service implementation class</a>:</p>

<pre><code class="language-java">@ManagedResource(objectName = EchoService.MBEAN_NAME)
public class EchoServiceImpl implements EchoService {

    @Override
    @ManagedOperation
    public String echo(String input) {
        return &quot;You said: &quot; + input;
    }
}
</code></pre>

<p>&hellip; as well as Spring configuration file <em>services-context.xml</em>:</p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;context:annotation-config/&gt;
    &lt;context:mbean-export/&gt;

    &lt;bean id=&quot;echoService&quot; class=&quot;com.example.service.EchoServiceImpl&quot;/&gt;

&lt;/beans&gt;
</code></pre>

<p>Here the <a href="http://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/jmx.html" target="_blank">JMX export feature</a>
of <a href="http://springframework.org" target="_blank">SpringFramework</a> is used.</p>

<p>And a <em>web.xml</em> descriptor is:</p>

<pre><code class="language-xml">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee
          http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;
         version=&quot;3.0&quot;&gt;

    &lt;display-name&gt;Servlet 3.0 Web Application&lt;/display-name&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;classpath:/services-context.xml&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
    &lt;/listener&gt;
&lt;/web-app&gt;
</code></pre>

<p>Third module, <em>ui.war</em>, will contain a servlet, which will use the service:</p>

<pre><code class="language-java">@WebServlet(urlPatterns = &quot;/echo/*&quot;)
public class EchoServlet extends HttpServlet {

    @Autowired
    private EchoService echoService;

    @Override
    public void init(ServletConfig config) throws ServletException {
        SpringBeanAutowiringSupport.processInjectionBasedOnServletContext(this,
                config.getServletContext());
        System.out.println(&quot;Servlet initialized&quot;);
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        final String input = req.getPathInfo();

        final String output = echoService.echo(input);

        resp.setBufferSize(1024);
        resp.setStatus(HttpServletResponse.SC_OK);
        resp.setContentType(&quot;text/plain&quot;);
        resp.setCharacterEncoding(&quot;UTF-8&quot;);
        resp.getWriter().write(output);
        resp.getWriter().close();
    }
}
</code></pre>

<p>spring context configuration <em>web-context.xml</em>:</p>

<pre><code class="language-xml">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
           xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
           xmlns:util=&quot;http://www.springframework.org/schema/util&quot;
           xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd&quot;&gt;

        &lt;bean id=&quot;echoService&quot; class=&quot;org.springframework.jmx.access.MBeanProxyFactoryBean&quot; lazy-init=&quot;true&quot;&gt;
            &lt;property name=&quot;objectName&quot;&gt;
                &lt;util:constant static-field=&quot;com.example.service.EchoService.MBEAN_NAME&quot;/&gt;
            &lt;/property&gt;
            &lt;property name=&quot;proxyInterface&quot; value=&quot;com.example.service.EchoService&quot;/&gt;
        &lt;/bean&gt;

    &lt;/beans&gt;
</code></pre>

<p><em>web.xml</em> descriptor:</p>

<pre><code class="language-xml">    &lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
             xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
             xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee
              http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;
             version=&quot;3.0&quot;&gt;

        &lt;display-name&gt;Servlet 3.0 Web Application&lt;/display-name&gt;

        &lt;context-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;WEB-INF/web-context.xml&lt;/param-value&gt;
        &lt;/context-param&gt;

        &lt;listener&gt;
            &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
        &lt;/listener&gt;
    &lt;/web-app&gt;
</code></pre>

<p>When those two webapps are deployed to tomcat, a new JMX bean is created:
<img src="http://blog.konstantinpavlov.net/assets/2014/05/tomcat-mbean-service.png" alt="EchoService exposed as Managed Bean" /></p>

<p>and service is accessible from the servlet:
<img src="http://blog.konstantinpavlov.net/assets/2014/05/tomcat-service-invoked.png" alt="EchoServlet showing results of EchoService invocation" /></p>

<h3 id="module-dependencies">Module dependencies</h3>

<p>All web modules should depend on <em>api.jar</em> module, because it contains a service interface.</p>

<p>While your service method signatures contains only standard java classes, available across the Tomcat server,
you may not care about classloading issues. In this case both <em>service.war</em> and <em>ui.war</em> should contain <em>api.jar</em> as a dependency in their <code>WEB-INF/lib</code> directory.</p>

<p>But if you want to return from your service method some custom class,
you&rsquo;ll need to put that class to <em>api.jar</em> and place that JAR to <code>${catalina.base}/lib</code> folder to make that classes available to all web applications. In this case <em>api.jar</em> should be declared as <em>provided</em> dependency in webapp modules.</p>

<p>Having sharing classes in a common classloader eliminates the need of data serialization/deserialization.</p>

<p>Sources from this article you may find <a href="https://gist.github.com/kpavlov/3e19dcec52b56d550e21" target="_blank">here</a>.</p>
          </div>
          <footer class="post-footer">
            <div itemprop="author" itemscope itemtype="http://schema.org/Person" class="post-author">
                <a href="http://blog.konstantinpavlov.net/" class="post-author-avatar">
                  <img itemprop="image" src="http://blog.konstantinpavlov.net/img/avatar-128.png" alt="Konstantin Pavlov">
                </a>
              <div class="post-author-info">
                <h4 class="post-footer-heading">Written By</h4>
                <a href="http://blog.konstantinpavlov.net/" itemprop="url" class="post-author-name">
                  <span itemprop="name">Konstantin Pavlov</span>
                </a>
                <p itemprop="description" class="post-author-bio"></p>
                
                  <p class="post-author-location" itemprop="homeLocation">Limassol, Cyprus</p>
                
                
                <p class="post-info">
                  <b class="post-info-title">Published on</b>
                  <time class="post-date">May 9, 2014</time>
                </p>
              </div>
            </div>
            <div class="post-social">
              <h4 class="post-footer-heading">Spread the word</h4>
              <a href="#" data-action="share-twitter"><i class="fa fa-fw fa-lg fa-twitter"></i></a>
              <a href="#" data-action="share-facebook"><i class="fa fa-fw fa-lg fa-facebook"></i></a>
              <a href="#" data-action="share-gplus"><i class="fa fa-fw fa-lg fa-google-plus"></i></a>
            </div>
          </footer>

          <nav role="pagination" class="post-list-pagination">
            
            <a href="http://blog.konstantinpavlov.net/blog/2014/05/10/json-validation-with-json-schema/" class="post-list-pagination-item post-list-pagination-item-prev"
               title="JSON Validation with JSON Schema" data-pjax rel="prev">
              <i class="fa fa-angle-double-left"></i>&nbsp;JSON Validation with JSON Schema
            </a>
            
            
            <a href="http://blog.konstantinpavlov.net/blog/2014/03/31/vaadin-optimizing-sluggish-ui/" class="post-list-pagination-item post-list-pagination-item-next"
               title="Vaadin: Optimizing Sluggish UI" data-pjax rel="next">
              Vaadin: Optimizing Sluggish UI&nbsp;<i class="fa fa-angle-double-right"></i>
            </a>
            
          </nav>

        </section>
      
      <section itemprop="comment" class="post-comments">
        <div id="disqus_thread"></div>
      </section>
      
    </article>

                <footer role="contentinfo" class="footer">
  <p><small>© 2016. All Rights Reserved.</small></p>
  <p><small>Hugo <a href="https://github.com/kpavlov/hugo-theme-ghostiumx" target="_blank">GhostiumX Theme</a> by <a href="https://twitter.com/k_pavlov" target="_blank">@k_pavlov</a> based on original <a href="http://ghostium.oswaldoacauan.com/" target="_blank">Ghostium Theme</a> by <a href="https://twitter.com/oswaldoacauan" target="_blank">@oswaldoacauan</a></small></p>
  <p><small>Proudly published with <a href="http://gohugo.io/" target="_blank">Hugo</a></small></p>
</footer>



              </div>
            </section>
          </div>
        </div>
      </div>
    </main>


    
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script>
        window.jQuery || document.write('<script src="assets/js/jquery-3.1.1.min.js">\x3C/script>');
    </script>

    

   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.pjax/1.9.6/jquery.pjax.min.js" integrity="sha256-Xuf/Wtp4J0pHH1OolTHfRbWP2FkR6WaB69ut7w4FxpY=" crossorigin="anonymous"></script>

    <dialog id="cookiePolicyPopup" open="false" style="display: none">

  This site uses cookies to ensure you get the best experience on the site. By continuing to use the site, you agree to accept these cookies.
     <div role="toolbar">
         <button id="cookiePolicyAccept">OK</button>
         <a href="http://blog.konstantinpavlov.net/legal/cookie-policy">Read More</a>
     </div>
</dialog>
    <script src="http://blog.konstantinpavlov.net/assets/js/prism.min.js?v=1477977074"></script>
    <script src="http://blog.konstantinpavlov.net/assets/js/foot-scripts.min.js?v=1477977074"></script>

    <script type="text/javascript">

      
        
          if(GHOSTIUM.haveDisqus) {
            var disqus_developer = 1;
            var disqus_shortname = 'konstantinpavlov';


            if(typeof DISQUS !== 'object') {
              (function () {
              var s = document.createElement('script'); s.async = true;
              s.type = 'text/javascript';
              s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
              }());
            }
          } else {
            document.querySelector('.post-comments').remove();
          }
        
      


      (function(g,h,o,s,t,z){g.GoogleAnalyticsObject=s;g[s]||(g[s]=
              function(){(g[s].q=g[s].q||[]).push(arguments)});g[s].s=+new Date;
          t=h.createElement(o);z=h.getElementsByTagName(o)[0];
          t.src='https://www.google-analytics.com/analytics.js';
          z.parentNode.insertBefore(t,z)}(window,document,'script','ga'));
      ga('create','UA-2530248-1');ga('send','pageview');


      if(GHOSTIUM.haveDisqus) {
        var disqus_developer = 1;
        var disqus_shortname = 'konstantinpavlov';

        (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
      }
    </script>

  </body>
</html>
